See spec.pdf for more details.
